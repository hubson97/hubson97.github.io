<!DOCTYPE html>
<html>
<head>
    <title>PUM lab3</title>
</head>
<body>

    <canvas height="600" width="800" id="myCanvas"></canvas>
    
    
    <script>
        let points = 0;

        let posX = 400;
        const posY = 520; 
        const rectWidth = 80;
        const rectHeight = 50;

        const canvas = document.getElementById("myCanvas");
        const context = canvas.getContext("2d");

        canvas.style.background = "#808080";

        const bullets = [];
        const opponents = [];

     
        setInterval(() => {

            drawRectangle();

            bullets.forEach((bullet)=>{
                bullet.showBullet();
            })
            opponents.forEach((opponent)=>{
                opponent.showOpponent();
            })
            showPoints();
            collisionsChecking();

        }, 10);

        setInterval(() => {
            addOpponent();
        }, 2000);


        function drawRectangle() {
            context.clearRect(0, 0, canvas.width, canvas.height);

            context.beginPath();
            context.rect(posX,posY,rectWidth,rectHeight);
            context.fillStyle="red";
            context.fill();
            context.stroke();
            context.closePath();
        }

        drawRectangle();

        function showPoints() {
            context.font = "55px serif";
            context.fillText(points, 5, 40);
        }

        window.addEventListener("keydown", keysPressed, false);
        window.addEventListener("keyup", keysReleased, false);
        
        var keys = [];
        
        function keysPressed(e) {
            
            keys[e.keyCode] = true;
        
            // left
            if (keys[37]) {
                posX -= 8;
            }
        
            // right
            if (keys[39]) {
                posX += 8;
            }
            
            if(keys[32]){
                bullets.push(new Bullet());
            }
        
            e.preventDefault();
                    
        }
        
        function keysReleased(e) {
            keys[e.keyCode] = false;
        }   

        function addOpponent() {
            opponents.push(new Opponent());
        }

        function deleteOpponent(opponent){
            const id = opponents.indexOf(opponent);
            opponents.splice(id, 1);
            delete opponent;
        }

        function deleteBullet(bullet) {
            const id = bullets.indexOf(bullet);
            bullets.splice(id, 1);
            delete projectile;
        }

        const isColliding = (opponent, bullet) =>
                (opponent.getRadius() + bullet.getRadius()) ** 2 >
                (opponent.getX() - bullet.getX()) ** 2 +
                    (opponent.getY() - bullet.getY()) ** 2;

        function collisionsChecking(){
            opponents.forEach((opponent) => {
                bullets.forEach((bullet) => {
                    if (isColliding(opponent, bullet)) {
                        points++;
                        deleteOpponent(opponent);
                        deleteBullet(bullet);
                    }
                });
            });
        }


        function getRandomInt(min, max) {
            min = Math.ceil(min);
            max = Math.floor(max);
            return Math.floor(Math.random() * (max - min) + min); //The maximum is exclusive and the minimum is inclusive
        }

        class Bullet{
            constructor(){
                this.bulletX = posX + rectWidth / 2;
                this.bulletY = posY;
                this.radius = 5;
            }

            
            moveBullet(){
                this.bulletY -= 5;
            }

            showBullet(){
                context.beginPath();
                this.moveBullet();
                context.fillStyle="black";
                context.arc(this.bulletX,this.bulletY, this.radius,0,2 * Math.PI);
                context.fill();
                context.stroke();
                context.closePath();
            }

            getRadius() {
                return this.radius;
            }

            getY() {
                return this.bulletY;
            }

            getX() {
                return this.bulletX;
            }


        }

        class Opponent{
            constructor(){
                this.oppoX = getRandomInt(20, 800);
                this.oppoY = 25;
                this.radius = 20;
            }

            moveOpponent(){
                this.oppoY +=2;
            }

            showOpponent(){
                context.beginPath();
                this.moveOpponent();
                context.fillStyle = "green";
                context.arc(this.oppoX,this.oppoY,20,0,2 * Math.PI);
                context.fill();
                context.stroke();
                context.closePath();
            }

            getRadius() {
                return this.radius;
            }

            getY() {
                return this.oppoY;
            }

            getX() {
                return this.oppoX;
            }

        }

    </script>


</body>
</html>